(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{345:function(e,a,t){"use strict";t.r(a);var s=t(10),n=Object(s.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"how-to-configure-nginx-web-server-as-reverse-proxy-and-load-balancer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-configure-nginx-web-server-as-reverse-proxy-and-load-balancer"}},[e._v("#")]),e._v(" How to configure Nginx web server as reverse proxy and load balancer")]),e._v(" "),a("p",[e._v("By: Nazmul Islam (Swapan) - DevOps Engineer")]),e._v(" "),a("h2",{attrs:{id:"aws-secure-environment-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aws-secure-environment-setup"}},[e._v("#")]),e._v(" AWS secure environment setup:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Create a vpc on your preferred aws region (172.20.0.0/16)")])]),e._v(" "),a("li",[a("p",[e._v("Create 1 public subnet for public facing webserver (172.20.10.0/24)")])]),e._v(" "),a("li",[a("p",[e._v("Create 2 private subnet for serving web application to the public server on 2 differant availability zone (172.20.20.0/24) and (172.20.30.0/24)")])]),e._v(" "),a("li",[a("p",[e._v("Create 1 IGW and attached to your vpc")])]),e._v(" "),a("li",[a("p",[e._v("Create 1 NAT gateway on public subnet to access internet from private subnets")])]),e._v(" "),a("li",[a("p",[e._v("Create 3 Route Table for each subnet and associate accordingly and add route 0.0.0.0/0 via igw on public route table and add route 0.0.0.0/0 via nat gateway on private subnets.")])]),e._v(" "),a("li",[a("p",[e._v("Create 1 Ec2 ubuntu server on public subnet and add security group with ssh, http access.")])]),e._v(" "),a("li",[a("p",[e._v("Create 2 Ec2 ubuntu server on private subnet on 2 differant availability zone with ssh and http access.")])])]),e._v(" "),a("h2",{attrs:{id:"configuring-nginx-public-web-server-as-load-balancer-and-reverse-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-nginx-public-web-server-as-load-balancer-and-reverse-proxy"}},[e._v("#")]),e._v(" Configuring Nginx public web server as load balancer and reverse proxy")]),e._v(" "),a("ul",[a("li",[e._v("Nginx")])]),e._v(" "),a("blockquote",[a("p",[e._v("Nginx is an open source, fast, lightweight and high-performance web server that can be used to serve static files. NGINX is considered as the popular web server behind Apache web server and Microsoft's IIS. NGINX improves content and application delivery, improves security, and facilitates scalability and availability for the busiest websites on the internet.")])]),e._v(" "),a("ul",[a("li",[e._v("Nginx Reverse Proxy")])]),e._v(" "),a("blockquote",[a("p",[e._v("A proxy is a server that resides between internal applications and external clients, forwarding client requests to the appropriate server. An Nginx reverse proxy server is a proxy server that resides behind the firewall in a private network and directs client requests to the appropriate backend server. A reverse proxy gives an additional level of abstraction and control to ensure the smooth flow of network traffic between clients and servers.")])]),e._v(" "),a("ul",[a("li",[e._v("ssh to your public ec2 ubuntu instance to prepare the environment")])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"your-pem-key.pem"')]),e._v(" ubuntu@your-public-ip\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" update\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-y")]),e._v(" docker.io\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-itd")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("80")]),e._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--name")]),e._v(" nginx-lb "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("always nginx:latest\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-it")]),e._v(" nginx-lb "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" update\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v("\n\n")])])]),a("h3",{attrs:{id:"how-to-configure-nginx-as-a-reverse-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-configure-nginx-as-a-reverse-proxy"}},[e._v("#")]),e._v(" How to configure Nginx as a reverse proxy")]),e._v(" "),a("ul",[a("li",[e._v("Open the Nginx configuration file with elevated rights.")]),e._v(" "),a("li",[e._v("Map a URI to the upstream cluster with a proxy_pass location setting.")]),e._v(" "),a("li",[e._v("Restart the Nginx server to incorporate the config changes.")])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-it")]),e._v(" nginx-lb "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v(" /etc/nginx/conf.d/default.conf\n\n    location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        root   /usr/share/nginx/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n        index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n        proxy_pass   http://your-private-server-ip:port/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\ncontrol+x "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("then")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("yes")]),e._v(" to save and "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exit")]),e._v(" the file.\n\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-t")]),e._v(" \n\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-s")]),e._v(" reload\n\n")])])]),a("h3",{attrs:{id:"how-to-configure-nginx-as-a-load-balancer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-configure-nginx-as-a-load-balancer"}},[e._v("#")]),e._v(" How to configure Nginx as a load balancer")]),e._v(" "),a("ul",[a("li",[e._v("Open the Nginx configuration file with elevated rights.")]),e._v(" "),a("li",[e._v("Define an upstream element and list each node in your backend cluster.")]),e._v(" "),a("li",[e._v("Map a URI to the upstream cluster with a proxy_pass location setting.")]),e._v(" "),a("li",[e._v("Restart the Nginx server to incorporate the config changes.")])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-it")]),e._v(" nginx-lb "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("nano")]),e._v(" /etc/nginx/conf.d/default.conf\n\nupstream webservers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    server "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("172.20")]),e._v(".20.25:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    server "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("172.20")]),e._v(".30.35:8090"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    server your-server-ip:port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\nlocation / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        root   /usr/share/nginx/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n        index  index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n        proxy_pass   http://webservers/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\ncontrol+x "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("then")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("yes")]),e._v(" to save and "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exit")]),e._v(" the file.\n\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-t")]),e._v(" \n\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-s")]),e._v(" reload\n\n")])])]),a("h2",{attrs:{id:"configuring-nginx-on-private-subnet-s-ec2-as-web-application-server-01"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-nginx-on-private-subnet-s-ec2-as-web-application-server-01"}},[e._v("#")]),e._v(" Configuring Nginx on private subnet's ec2 as web application server 01")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("ssh on your private ec2 ubuntu instances from your public ec2 server with pem key to prepare the web server")])]),e._v(" "),a("li",[a("p",[e._v("to copy the pem key from your local machine to public server use below command")])])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("scp")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" your-pem-key.pem ~/your-file-path-on-local-machine/ ubuntu@your-ec2-public-server-ip:~/your-desired-location\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"your-pem-key.pem"')]),e._v(" ubuntu@your-private-server-ip\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" update\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" docker.io \n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("scp")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" your-pem-key.pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-r")]),e._v(" ~/your-file-path-on-local-machine/ ubuntu@your-ec2-private-server-ip:~/your-desired-location \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("This web-content should be copied from your public server. Or you can clone your "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" repo to your private server directly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-v")]),e._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone git@gitlab.com:your-account/your-repo.git\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-itd")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8080")]),e._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--name")]),e._v(" web-server1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("always "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-v")]),e._v(" ~/your--git-repo-location:/usr/share/nginx/html nginx:latest\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ps")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-a")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" localhost:8080\n\n")])])]),a("h2",{attrs:{id:"configuring-nginx-on-private-subnet-s-ec2-as-web-application-server-02"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuring-nginx-on-private-subnet-s-ec2-as-web-application-server-02"}},[e._v("#")]),e._v(" Configuring Nginx on private subnet's ec2 as web application server 02")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("ssh on your private ec2 ubuntu instances from your public ec2 server with pem key to prepare the web server")])]),e._v(" "),a("li",[a("p",[e._v("to copy the pem key from your local machine to public server use below command")])])]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("scp")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" your-pem-key.pem ~/your-file-path-on-local-machine/ ubuntu@your-ec2-public-server-ip:~/your-desired-location\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ssh")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"your-pem-key.pem"')]),e._v(" ubuntu@your-private-server-ip\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" update\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" docker.io \n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("scp")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-i")]),e._v(" your-pem-key.pem "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-r")]),e._v(" ~/your-file-path-on-local-machine/ ubuntu@your-ec2-private-server-ip:~/your-desired-location \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("This web-content should be copied from your public server. Or you can clone your "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" repo to your private server directly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-v")]),e._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone git@gitlab.com:your-account/your-repo.git\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-itd")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-p")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("8090")]),e._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--name")]),e._v(" web-server2 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("always "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-v")]),e._v(" ~/your--git-repo-location:/usr/share/nginx/html nginx:latest\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("ps")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-a")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" localhost:8090\n\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);